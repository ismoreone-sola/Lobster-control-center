<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOLA è¨˜äº‹æœ¬</title>
    <style>
        :root { --primary: #4a69bd; --success: #38ada9; --danger: #eb4d4b; --bg: #f5f6fa; --card: #ffffff; }
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #2f3640; }
        .container { max-width: 600px; margin: 20px auto; background: var(--card); border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); padding: 30px 20px; }
        header { text-align: center; margin-bottom: 30px; }
        .logo { font-size: 2.2em; font-weight: 800; color: var(--primary); letter-spacing: -1px; }
        
        .action-card { background: #fafbfc; border: 2px solid #f1f2f6; border-radius: 20px; padding: 40px 20px; text-align: center; margin-bottom: 30px; }
        #recordBtn { background: var(--primary); color: white; border: none; padding: 20px 40px; border-radius: 50px; font-size: 1.3em; font-weight: 700; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); width: 100%; max-width: 280px; box-shadow: 0 8px 20px rgba(74, 105, 189, 0.2); }
        #recordBtn:active { transform: scale(0.96); }
        #recordBtn.recording { background: var(--danger); animation: glow 1.5s infinite; }
        @keyframes glow { 0% { box-shadow: 0 0 0 0 rgba(235, 77, 75, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(235, 77, 75, 0); } 100% { box-shadow: 0 0 0 0 rgba(235, 77, 75, 0); } }
        
        #timer { margin-top: 15px; font-size: 1.1em; font-weight: 600; color: #7f8c8d; height: 1.5em; }
        
        .log-wrap { text-align: left; }
        .log-header { font-size: 1.1em; font-weight: 700; margin-bottom: 15px; padding: 0 5px; display: flex; justify-content: space-between; align-items: center; }
        .count-tag { font-size: 0.7em; background: #dfe4ea; padding: 2px 8px; border-radius: 10px; color: #747d8c; }
        #msgLog { min-height: 200px; }
        .msg-item { background: #fff; border: 1px solid #f1f2f6; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); animation: slideUp 0.4s ease-out; position: relative; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .msg-time { font-size: 0.8em; color: var(--primary); font-weight: 600; margin-bottom: 4px; display: block; opacity: 0.7; }
        .msg-text { line-height: 1.6; font-size: 1.05em; color: #2d3436; }
        
        footer { margin-top: 30px; text-align: center; color: #ced6e0; font-size: 0.85em; }
        
        @media (max-width: 480px) {
            .container { margin: 0; border-radius: 0; min-height: 100vh; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">SOLA è¨˜äº‹æœ¬ ğŸ“”</div>
        </header>

        <div class="action-card">
            <button id="recordBtn">æŒ‰é€™ç•™è¨€</button>
            <div id="timer">é»æ“ŠæŒ‰éˆ•é–‹å§‹ (é™æ™‚10ç§’)</div>
        </div>

        <div class="log-wrap">
            <div class="log-header">
                <span>è¨˜äº‹ç´€éŒ„ <span class="count-tag">ä¸Šé™ 50 æ¢</span></span>
            </div>
            <div id="msgLog"></div>
        </div>

        <footer>
            &copy; 2026 SOLA NOTE Â· å€‹äººèªéŸ³è¨˜äº‹
        </footer>
    </div>

    <script>
        const btn = document.getElementById('recordBtn');
        const timer = document.getElementById('timer');
        const log = document.getElementById('msgLog');
        const MAX_MESSAGES = 50;

        let logs = JSON.parse(localStorage.getItem('sola_notebook_v2') || '[]');
        render();

        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Recognition) {
            timer.innerText = "ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜";
            btn.disabled = true;
        }

        function render() {
            if (logs.length === 0) {
                log.innerHTML = '<div style="color:#ced6e0; text-align:center; padding-top:50px;">ç›®å‰æ²’æœ‰è¨˜äº‹å…§å®¹</div>';
                return;
            }
            log.innerHTML = logs.map(m => `
                <div class="msg-item">
                    <span class="msg-time">${m.time}</span>
                    <div class="msg-text">${m.text}</div>
                </div>
            `).join('');
        }

        function addNote(text) {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
            
            // æ–°å¢è‡³é¦–ä½ (Unshift)
            logs.unshift({ time: timeStr, text: text });
            
            // è¶…é50æ¢è‡ªå‹•åˆªé™¤æœ€èˆŠçš„ (Pop)
            if (logs.length > MAX_MESSAGES) {
                logs.pop();
            }
            
            localStorage.setItem('sola_notebook_v2', JSON.stringify(logs));
            render();
        }

        if (Recognition) {
            const recog = new Recognition();
            recog.lang = 'zh-HK';
            recog.interimResults = false;
            
            let countdown;
            let countVal = 10;

            recog.onstart = () => {
                btn.classList.add('recording');
                btn.innerText = 'æ­£åœ¨è½å–...';
                countVal = 10.0;
                timer.style.color = '#eb4d4b';
                
                countdown = setInterval(() => {
                    countVal -= 0.1;
                    timer.innerText = `å‰©é¤˜æ™‚é–“: ${Math.max(0, countVal).toFixed(1)}s`;
                    if (countVal <= 0) {
                        clearInterval(countdown);
                        recog.stop();
                    }
                }, 100);
            };

            recog.onresult = (e) => {
                const text = e.results[0][0].transcript;
                addNote(text);
            };

            recog.onend = () => {
                btn.classList.remove('recording');
                btn.innerText = 'æŒ‰é€™ç•™è¨€';
                timer.style.color = '#7f8c8d';
                timer.innerText = 'è¨˜äº‹å·²å„²å­˜';
                clearInterval(countdown);
                setTimeout(() => { if(btn.innerText === 'æŒ‰é€™ç•™è¨€') timer.innerText = 'é»æ“ŠæŒ‰éˆ•é–‹å§‹ (é™æ™‚10ç§’)'; }, 3000);
            };

            btn.onclick = () => {
                if (btn.classList.contains('recording')) return;
                try { recog.start(); } catch(e) {}
            };
        }
    </script>
</body>
</html>